---
aliases: ["DataStore", "Preferences DataStore", "Proto DataStore"]
tags: [jetpack, datastore, persistence, interview]
created: 2025‚Äë05‚Äë04
---

## üìù Question  
–ß—Ç–æ —Ç–∞–∫–æ–µ DataStore –∏ —á–µ–º –æ–Ω –ª—É—á—à–µ SharedPreferences?

## ‚úÖ Answer  
**DataStore** ‚Äì —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä "–∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ" –≤ Android, –ø—Ä–∏—à–µ–¥—à–∏–π –Ω–∞ —Å–º–µ–Ω—É `SharedPreferences`. DataStore –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ Jetpack (AndroidX) –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: **Preferences DataStore** (–∞–Ω–∞–ª–æ–≥ SharedPreferences, —Ö—Ä–∞–Ω–∏—Ç –Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ key-value) –∏ **Proto DataStore** (—Ö—Ä–∞–Ω–∏—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –ø—Ä–æ—Ç–æ–±—É—Ñ-—Å—Ö–µ–º).

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ DataStore –Ω–∞–¥ SharedPreferences:

- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** SharedPreferences —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ: –º–µ—Ç–æ–¥—ã `commit()` –≤—ã–ø–æ–ª–Ω—è—é—Ç –∑–∞–ø–∏—Å—å –Ω–∞ –¥–∏—Å–∫ –≤ —Ç–µ–∫—É—â–µ–º –ø–æ—Ç–æ–∫–µ, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ —Ç–æ—Ä–º–æ–∑–∞–º, –µ—Å–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ. DataStore –∂–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ–≤–µ—Ä—Ö –∫–æ—Ä—É—Ç–∏–Ω –∏ Flow ‚Äì –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ. –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ Flow –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ—É–Ω–∫—Ü–∏–∏ suspend –¥–ª—è –∑–∞–ø–∏—Å–∏. –ù–µ—Ç —Ä–∏—Å–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ UI –ø–æ—Ç–æ–∫–∞.
    
- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–µ–π:** SharedPreferences –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –∑–∞–ø–∏—Å—è—Ö –º–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ commit –ø–æ–¥—Ä—è–¥, –∏–ª–∏ commit vs apply). DataStore –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞–ø–∏—Å–∏. –ó–∞–ø–∏—Å–∏ –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å.
    
- **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–≤ —Å–ª—É—á–∞–µ Proto DataStore):** –í—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç–µ .proto-—Å—Ö–µ–º—É (–∫–∞–∫ –¥–ª—è gRPC) —Å —Ç–∏–ø–∞–º–∏, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–ª–∞—Å—Å, –∏ DataStore –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/—á—Ç–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞. –≠—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –æ—à–∏–±–∫–∏ —Å –æ–ø–µ—á–∞—Ç–∫–æ–π –≤ –∫–ª—é—á–∞—Ö, –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ–º —Ç–∏–ø–æ–≤. Preferences DataStore —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –Ω–æ —Ç–∞–º –∫–ª—é—á–∏-—Å—Ç—Ä–æ–∫–∏, –ø–æ—Ö–æ–∂ –Ω–∞ SharedPrefs, —Ö–æ—Ç—è –∏ —Å Flow.
    
- **Reactive API:** –ß—Ç–µ–Ω–∏–µ DataStore –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **Flow** ‚Äì —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ù–∞–ø—Ä–∏–º–µ—Ä,
    
    ```kotlin
    dataStore.data.map { prefs -> prefs[SettingsKeys.USERNAME] ?: "Unknown" }
    ```
    
    –≤–µ—Ä–Ω–µ—Ç Flow, –∫–æ—Ç–æ—Ä—ã–π —ç–º–∏—Ç–∏—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –æ–Ω–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å. –í SharedPreferences –µ—Å—Ç—å —Å–ª—É—à–∞—Ç–µ–ª–∏, –Ω–æ API –º–µ–Ω–µ–µ —É–¥–æ–±–Ω—ã–π –∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç coroutines natively.
    
- **–ù–µ—Ç deprecated:** SharedPreferences —Ö–æ—Ç—å –∏ –Ω–µ –æ–±—ä—è–≤–ª–µ–Ω –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–º, –Ω–æ Google —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ DataStore –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç–æ–∫, –ø–æ—Ç–æ–º—É —á—Ç–æ DataStore —Ä–µ—à–∞–µ—Ç —Ä—è–¥ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º SharedPreferences (–∫–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å).
    

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ DataStore (Preferences):**

```kotlin
val Context.dataStore by preferencesDataStore(name = "settings")

// –ó–∞–ø–∏—Å—å:
suspend fun saveUsername(name: String) {
    context.dataStore.edit { prefs ->
        prefs[SettingsKeys.USERNAME] = name
    }
}
// –ß—Ç–µ–Ω–∏–µ:
val userNameFlow: Flow<String> = context.dataStore.data
    .map { prefs -> prefs[SettingsKeys.USERNAME] ?: "Unknown" }
```

–≥–¥–µ `SettingsKeys.USERNAME` ‚Äì —ç—Ç–æ –∫–ª—é—á, —Å–æ–∑–¥–∞–Ω–Ω—ã–π —á–µ—Ä–µ–∑ `preferencesKey<String>("username")`.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Proto DataStore:** —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ö–µ–º—ã .proto –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞—Å—Å, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äì

```kotlin
val Context.protoDataStore by dataStore(
    fileName = "user_prefs.pb",
    serializer = UserPrefsSerializer  // handles read/write of the proto object
)
// To update:
dataStore.updateData { current ->
    current.toBuilder().setUsername(name).build()
}
```

–í Proto DataStore `updateData` lambda –¥–∞–µ—Ç –≤–∞–º —Ç–µ–∫—É—â–∏–π –æ–±—ä–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫, –∏ –≤—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π. DataStore —Å–∞–º –∑–∞–ø–∏—à–µ—Ç.

–í –∏—Ç–æ–≥–µ DataStore ‚Äì –±–æ–ª–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ, –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ API –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–±–æ–ª—å—à–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. SharedPreferences ‚Äì —Å—Ç–∞—Ä–æ–µ API, —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ DataStore –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ.

## üîç –°–º.¬†—Ç–∞–∫–∂–µ  
- [[room]]
- [[livedata]]
