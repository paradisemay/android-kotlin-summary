---
aliases: ["Retrofit error handling", "–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏"]
tags: [network, retrofit, error, interview]
created: 2025‚Äë05‚Äë04
---

## üìù Question  
–ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏ –∏ HTTP‚Äë–æ—Ç–≤–µ—Ç–æ–≤ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Retrofit?

## ‚úÖ Answer  
–ü—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å API –≤—Å–µ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –æ—à–∏–±–∫–∏: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–µ—Ç–∏, —Ç–∞–π–º–∞—É—Ç—ã, –æ—Ç–≤–µ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞ —Å –∫–æ–¥–æ–º –æ—à–∏–±–∫–∏ (4xx, 5xx), –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –í Retrofit –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –¥–≤–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: **–∏—Å–∫–ª—é—á–µ–Ω–∏—è (failures)** –∏ **–æ—à–∏–±–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (HTTP errors)**.

- **–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:** –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–µ–ª —Å–±–æ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ç–∏ (–Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, —Ç–∞–π–º–∞—É—Ç, DNS –æ—à–∏–±–∫–∞), Retrofit (—Ç–æ—á–Ω–µ–µ OkHttp) –±—Ä–æ—Å–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –æ–±—ã—á–Ω–æ `IOException`. –í —Å–ª—É—á–∞–µ, –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º `Call.enqueue`, –æ–Ω–æ –ø–æ–ø–∞–¥–µ—Ç –≤ `onFailure`. –í —Å–ª—É—á–∞–µ coroutines (suspend —Ñ—É–Ω–∫—Ü–∏—è), —ç—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–ª–µ—Ç–∏—Ç –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ try/catch:
    
    ```kotlin
    try {
        val user = api.getUser(id)  // suspend call
    } catch(e: IOException) {
        // –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏–ª–∏ –¥—Ä—É–≥–∞—è —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞
    }
    ```
    
    –¢–∞–∫–∂–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥—Ä—É–≥–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä `HttpException` (–¥–ª—è –ø–ª–æ—Ö–æ–≥–æ HTTP –∫–æ–¥–∞, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ Response wrapper).
    
- **–û—à–∏–±–æ—á–Ω—ã–µ HTTP-–∫–æ–¥—ã:** –ï—Å–ª–∏ –º–µ—Ç–æ–¥ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Call<T>` –∏–ª–∏ suspend fun –±–µ–∑ wrapping, —Ç–æ Retrofit –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—á–∏—Ç–∞–µ—Ç –æ—à–∏–±–∫–æ–π HTTP-–∫–æ–¥ –Ω–µ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 200-299 –∏ –±—Ä–æ—Å–∞–µ—Ç `HttpException`. –ï—Å–ª–∏ –∂–µ –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Call<Response<T>>` –∏–ª–∏ `suspend fun ...: Response<T>`, —Ç–æ –≤—ã —Å–∞–º–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ–±—ä–µ–∫—Ç Response –∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
    
    ```kotlin
    val response = api.getUserResponse(id)
    if(response.isSuccessful) {
        val user = response.body()
    } else {
        val code = response.code()
        val errorBody = response.errorBody()?.string()
        // –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–¥ –æ—à–∏–±–∫–∏
    }
    ```
    
    `response.errorBody()` –¥–∞–µ—Ç —Ç–µ–ª–æ –æ—à–∏–±–∫–∏ (–∫–æ—Ç–æ—Ä–æ–µ —Å–µ—Ä–≤–µ—Ä –º–æ–≥ –≤–µ—Ä–Ω—É—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, JSON —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ). –ï–≥–æ –º–æ–∂–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —á–µ—Ä–µ–∑ —Ç–æ—Ç –∂–µ Gson, –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏.
    
- **–ë–∏–∑–Ω–µ—Å-–æ—à–∏–±–∫–∏:** –î–∞–∂–µ –ø—Ä–∏ –∫–æ–¥–µ 200, —Å–µ—Ä–≤–µ—Ä –º–æ–≥ –≤–µ—Ä–Ω—É—Ç—å –ø–æ–ª–µ, —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, {"success":false, "message":"wrong password"}). –≠—Ç–æ —É–∂–µ –Ω–µ —É—Ä–æ–≤–µ–Ω—å HTTP, –∞ –ª–æ–≥–∏–∫–∏. –ò—Ö —Ç–æ–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ–ª–µ–π –æ—Ç–≤–µ—Ç–∞. –¢—É—Ç Retrofit –Ω–µ –ø–æ–º–æ–∂–µ—Ç –∫—Ä–æ–º–µ –∫–∞–∫ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç. –ù—É–∂–Ω–æ –≤ –∫–æ–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —Ä–µ—à–∏—Ç—å, —Å—á–∏—Ç–∞—Ç—å –ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–æ–π.
    

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:**

1. **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫–∏:** –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OkHttp Interceptor –∏–ª–∏ —Å–∞–º Retrofit callback. –ù–∞–ø—Ä–∏–º–µ—Ä, —Å OkHttp –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –≤—Å–µ –æ—Ç–≤–µ—Ç—ã, –∏ –µ—Å–ª–∏ `response.code == 401`, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–∞–∫–æ–µ-—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ (–æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –∏–ª–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏—Ç—å). –ò–ª–∏ `HttpLoggingInterceptor` —á—Ç–æ–±—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏.
    
2. **–í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±–µ—Ä—Ç–∫–æ–π:** –ü–æ–ª–µ–∑–Ω–æ –ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ API, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –Ω–µ –ø—Ä—è–º–æ –¥–∞–Ω–Ω—ã–µ, –∞ **Result —Ç–∏–ø** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Result<T>` –∏–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π sealed class). –ù–∞–ø—Ä–∏–º–µ—Ä,
    
    ```kotlin
    sealed class ApiResult<out T> { data class Success<T>(val data: T): ApiResult<T>(); data class Error(val code: Int?, val message: String?): ApiResult<Nothing>() }
    ```
    
    –ò —Å–¥–µ–ª–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç Retrofit –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ApiResult:
    
    ```kotlin
    try {
        val response = api.getUserResponse(id)
        if(response.isSuccessful) {
            ApiResult.Success(response.body()!!)
        } else {
            ApiResult.Error(response.code(), parseError(response))
        }
    } catch(e: IOException) {
        ApiResult.Error(null, "Network failure")
    }
    ```
    
    –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ —É–¥–æ–±–Ω–æ, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π —Ä–∞–∑ UI –ª–æ–≤–∏–ª –∏—Å–∫–ª—é—á–µ–Ω–∏—è ‚Äì –º—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤—Å–µ –≤ –µ–¥–∏–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
    
3. **–ö–æ—Ä—É—Ç–∏–Ω—ã + kotlin.Result:** –í Kotlin –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `runCatching { }` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ Result, –Ω–æ –Ω–∞–¥–æ –µ—â–µ –æ—à–∏–±–æ—á–Ω—ã–π HTTP –∫–æ–¥ —É—á–µ—Å—Ç—å.
    
4. **Retry –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö:** –ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ —Å–±–æ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Timeout). –ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É —Ä–µ—Ç—Ä–∞: –ª–æ–≤–∏–º IOException, –∂–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ, –ø–æ–≤—Ç–æ—Ä—è–µ–º —Å–Ω–æ–≤–∞. –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, Polly) –∏–ª–∏ –≤ Flow `.retryWhen`.
    
5. **UI/UX:** –û—Ç–¥–µ–ª—å–Ω–æ —Å—Ç–æ–∏—Ç —É–ø–æ–º—è–Ω—É—Ç—å: –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Äì —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–∫–∞, –Ω–æ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü—Ä–∏ —Å–µ—Ç–µ–≤–æ–π –æ—à–∏–±–∫–µ –æ–±—ã—á–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç Toast/snackbar "–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è", –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ", –ø—Ä–∏ –æ—à–∏–±–∫–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å" (–∏–∑ —Ç–µ–∫—Å—Ç–∞ –æ—à–∏–±–∫–∏). –≠—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–π–º–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫.
    

**–í—ã–≤–æ–¥ –¥–ª—è —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è:** –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –∫–∞–Ω–¥–∏–¥–∞—Ç –Ω–µ –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ "–≤—Å–µ –≤—Å–µ–≥–¥–∞ –æ–∫", –∞ —É–º–µ–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –Ω–µ—à—Ç–∞—Ç–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏: –∏ Java-–∏—Å–∫–ª—é—á–µ–Ω–∏—è, –∏ –∫–æ–¥—ã –æ—Ç–≤–µ—Ç–∞, –∏ –∑–Ω–∞–µ—à—å, –∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–ª–æ –æ—à–∏–±–∫–∏. –í–æ–∑–º–æ–∂–Ω–æ, —É–ø–æ–º—è–Ω—É—Ç—å, —á—Ç–æ Retrofit2 + coroutines: –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ Response, —Ç–æ –Ω—É–∂–Ω–æ try/catch HttpException.

## üîç –°–º.¬†—Ç–∞–∫–∂–µ  
- [[caching‚Äëretry]]
